<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan Hicks">
<meta name="dcterms.date" content="2013-01-30">

<title>The Funding Effect – Dan Hicks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-cf3f2c26eef976f46b51aa29f3e196e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="The Funding Effect – Dan Hicks">
<meta property="og:description" content="Website description">
<meta property="og:site_name" content="Dan Hicks ">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Dan Hicks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Teaching</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="https://data-science-methods.github.io/">
 <span class="dropdown-text">Methods of Data Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://fairy-shrimp.netlify.app/">
 <span class="dropdown-text">Notes for Critical Reasoning</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0001-7945-4416"> 
<span class="menu-text"><i class="fa-brands fa-orcid" aria-label="orcid"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=XvkwYZsAAAAJ&amp;hl=en"> 
<span class="menu-text"><i class="ai  ai-google-scholar" title="" style="color:"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://dhicks.github.io/cv"> 
<span class="menu-text"><i class="ai  ai-cv" title="" style="color:"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dhicks/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:dhicks4@ucmerced.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Funding Effect</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">data</div>
                <div class="quarto-category">funding</div>
                <div class="quarto-category">gm</div>
                <div class="quarto-category">hypothesis</div>
                <div class="quarto-category">local</div>
                <div class="quarto-category">market</div>
                <div class="quarto-category">markets</div>
                <div class="quarto-category">medicine</div>
                <div class="quarto-category">rights</div>
                <div class="quarto-category">satz</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dan Hicks </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 30, 2013</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In this series of posts, I’m applying Debra Satz’ account of noxious markets to a specific aspect of commercialized science, the funding effect. In <a href="http://jefais.tumblr.com/post/40261004397/satz-account-of-noxious-markets">the first post</a>, I summarized Satz’ account. In this post, I explain the funding effect.</p>
<p>(Please note that this series is an experiment in publicly posting sections of a paper as I write them. I look them over briefly for typos and the like, but my ideas here are still in development.)</p>
<p>The <em>funding effect</em> refers to a correlation between the findings of scientific research and the financial interests of the funders of the research. Industry-funded science is often significantly more likely to have reached conclusions that are favorable to industry than non-industry funded science. In a recent paper (<a href="#krimsky2012">2012</a>), Sheldon Krimsky has collected together several of the most prominent and well-established examples of the funding effect, including pharmaceuticals, tobacco, and bisphenol A (BPA). Another example, I think well-established by meta-analysis, is nutrition research:</p>
<blockquote class="blockquote">
<p>Funding source was significantly related to conclusions when considering all article types (p = 0.037). For interventional studies, the proportion with unfavorable conclusions was 0% for all industry funding versus 37% for no industry funding (p = 0.009). The odds ratio of a favorable versus unfavorable conclusion was 7.61 (95% confidence interval 1.27 to 45.73), comparing articles with all industry funding to no industry funding. (<a href="#lesser2007">Lesser et al.&nbsp;2007, 41</a>; see also <a href="#brownell2009">Brownell and Warner 2009</a>)</p>
</blockquote>
<p>And several authors have speculated in print about funding effects in environmental justice research (<a href="#steel2012">Steel and Whyte 2012, 177</a>) and safety testing of GMO crops (<a href="#byravan2010">Byravan 2010</a>). Kevin Elliott discussed the possibility of a funding effect in hormesis research in his book <em>Is a Little Pollution Good for You?</em>. (<a href="#elliott2011">Elliott 2011</a>; when I convert this series into a paper, I plan to discuss this book in more detail. For the sake of space, I won’t be doing that here.) Using the more general concept of <em>selective ignorance</em>, Elliott has also recently discussed something like the funding effect in agricultural research. (<a href="#elliott2012">Elliott 2012</a>)</p>
<p>It is important to recognize that, even when the funding effect is well documented, it is not necessarily caused by fabrication, deliberate manipulation of data, or individual scientists otherwise behaving badly. It is not even necessarily <em>epistemologically</em> problematic. For example, Krimsky notes that pharmaceuticals go through a long development process before a clinical trial; this process might screen out compounds that are less likely to be effective and more likely to have dangerous side effects. (<a href="#krimsky2012">Krimsky 2012, 7</a>) Or “me-too” pharmaceuticals – yet another statin, for example – might be tested on (and marketed to) “slightly different outcomes in slightly different kinds of patients” (6, quoting Angell). This may be an ordinary instance of Simpson’s paradox due to the complexity of human physiology: for unknown reasons, the pharmaceuticals really are more effective at promoting these specific outcomes in this specific small group.</p>
<p>These mechanisms underlying the funding effect are not so worrisome. However, Elliott identifies six other, more worrisome mechanisms.</p>
<ol type="1">
<li><p><strong>Choice of Questions</strong>: Posing a practical question – that is, a question about <em>what we shall do</em> – relies on various presuppositions: that we are in what John Dewey called a <em>problematic situation</em>; the nature of the problem; the kinds of actions we might take to solve it; and what would count as a successful (or at least better or worse) solution. For example, psychopharmacological research presupposes that we are looking for a pharmaceutical rather than psychotherapeutic solution.</p></li>
<li><p><strong>Metrics and Standards</strong>: Elliott gives the example of GDP, which measures aggregate wealth but is completely insensitive to (a) the distribution of wealth across the population, (b) non-economic costs, such as ecological damage, and (c) the relationship between wealth and the concrete activities that people can actually engage in. Since food crops genetically modified to be herbicide-resistant are often profitable for both the intellectual property rights holder and commercial farmers, they tend to rate rather highly using a metric tied to GDP. But because these crops do not have significantly higher yields than non-genetically modified versions, they would not fare very well using a metric of food production.</p></li>
<li><p><strong>Research Strategies</strong>: Any trial or data analysis involves numerous methodological decisions: How statistically powerful will the study be? Which animal models will we use? How long will we run the study? Will we compare with a placebo or an on-the-market compound? What criteria of inclusion will we use for our meta-analysis? What databases will we search to identify studies? Within the space of acceptable answers to these questions, there is ample room for subtle nudges in one direction or the other.</p>
<p>One especially important and simple example is the threshold for statistical significance that will be used. When investigating harmful effects of their funders’ products, researchers might adopt a high threshold, determine the findings to be statistically insignificant, and conclude that the products are not harmful. Then, when investigating beneficial effects, these same researchers might adopt a low threshold and determine that findings with exactly the same likelihood are significant and thus indicate that the products are beneficial. As Krimsky puts it, investigators may “set a high bar for establishing evidence of causality” (<a href="#krimsky2012">Krimsky 2012, 15</a>).</p></li>
<li><p><strong>Information Dissemination</strong>: As Elliott puts it, “if a wide body of information is available to a small number of scientists and corporate executives, it may still be socially problematic if only a small selection of that available information is widely known and discussed in the political sphere.” (<a href="#elliott2012">Elliott 2012, 12</a>) Confidentiality agreements, intellectual property law, and national security classifications can all be used to actively hide undesirable information. But passive measures can also be taken. For example, simply not publishing unfavorable or “null result” data leads to unrepresentative sampling in meta-analyses, and publishing in pay-for-access venues effectively blocks access for most members of the public.</p></li>
<li><p><strong>Choice of Language</strong>: To use an example from social science, consider the variety of decisions that must be made when formulating a definition of <em>income mobility</em>. Will we use nominal income or control for inflation? If the latter, we need to use some kind of market basket index – a fixed bundle of goods, the nominal price of which we track over time – which leads to issues about changing technology, consumer demand, and what counts as a decent standard of living. In just a few decades in the US, a household computer has gone from dream to hobby to luxury to necessity (to maybe-not necessity, if one has a relatively inexpensive smartphone, netbook, or tablet and access to a “regular” computer at work, for example). Will we look at single lifetimes or intergenerational mobility? That is, will we compare someone’s income at age 20 vs.&nbsp;age 40 vs.&nbsp;age 65? Or their income at age 40 vs.&nbsp;their parents at age 40? And how to deal with the fact that most households pool their incomes and many women have gone from unpaid to paid work? Both individual income and household incomes have their difficulties. Thus <a href="http://www.youtube.com/watch?v=vDhcqua3_W8">right-libertarian</a> and <a href="http://www.youtube.com/watch?v=sWpGJI1H17s">egalitarian liberal</a> economists can easily come to radically different conclusions on income mobility in the contemporary US.</p></li>
<li><p><strong>Translational Research</strong>: As Elliott puts it,</p>
<blockquote class="blockquote">
<p>Another crucial judgment is how to push new technological applications forward, given that they can yield very different sorts of practical knowledge. For example, the authors of the IAASTD lament that, because of intellectual property rights, local farmers are unlikely to be able to engage in the sorts of participatory research with GM seeds that would be needed in order to develop truly effective, locally appropriate technological innovations. (13)</p>
</blockquote>
<p>For example, genetic modification technology has already been used to develop more submergence-tolerant rice. (For a narrative account, see <a href="#ronaldadamchak2009">Ronald and Adamchak 2009, ch.&nbsp;1</a>.) Such rice would be quite valuable for rice farmers looking for non-herbicide ways to manage weeds: they can simply flood their paddies, drowning everything except the young rice shoots. And rice, of course, is one of the global staple crops, especially in Asian peasant agriculture. Despite this, of the five genetically modified rice events expected to be commercially available by 2015, none exhibits submergence-tolerance; one exhibits herbicide tolerance, one exhibits disease resistance, and three exhibit insect resistance.</p>
<p>In short, funders direct funds towards translational research that fits their interests. The resulting technologies, and the practical knowledge in their use, can thus be more carefully refined before undergoing clinical trial: we have a better understanding of the enabling conditions and limitations of the well-funded technology. Thus well-funded technology – such as transgenic crops provided with synthetic fertilizer, herbicides, and pesticides – is likely to perform better than poorly-funded competitor technology – such as organic or low-capital agriculture, which until recently was the exclusive province of subsistence farmers and marginalized radicals. (In this light, the fact that organic agriculture does about as well as conventional “industrial” agriculture in terms of yields gives some reason to believe organic has the potential to outperform conventional, if only it received commensurate funding. )</p></li>
</ol>
<p>Again, none of these six mechanisms is best characterized or explained in terms of fabrication or manipulation of data. The influence of values that underlies the funding effect can be much more subtle than this, while still being worrisome.</p>
<p>Does that mean that the funding effect, and the various recognized and its various possible underlying mechanisms, give reason to think that the market in scientific research is noxious? That’ll be the subject of part three.</p>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p>Brownell, Kelly and Kenneth Warner. “The Perils of Ignoring History: Big Tobacco Played Dirty and Millions Died. How Similar is Big Food?” <em>The Milbank Quarterly</em>, 87, no. 1: 259-294.</p></li>
<li><p>Byravan, Sujatha. “The Inter-Academy Report on Genetically Engineered Crops: Is It Making a Farce of Science?” <em>Economic and Political Weekly</em>, XLV, no. 43: 14-16.</p></li>
<li><p>Elliott, Kevin Christopher. <em>Is a Little Pollution Good for You?</em>. Oxford and New York: Oxford University Press, 2011.</p></li>
<li><p>Elliott, K C. “Selective Ignorance and Agricultural Research.” <em>Science, Technology &amp; Human Values</em>. doi:10.1177/0162243912442399.</p></li>
<li><p>Krimsky, S. “Do Financial Conflicts of Inteterest Bias Research? an Inquiry Into the ‘Funding Effect’ Hypothesis.” <em>Science, Technology &amp; Human Values</em>. doi:10.1177/0162243912456271.</p></li>
<li><p>Lesser, Lenard I, Cara B Ebbeling, Merrill Goozner, David Wypij, and David S Ludwig. “Relationship Between Funding Source and Conclusion Among Nutrition-Related Scientific Articles.” <em>PLOS Medicine</em> 4, no. 1: e5. doi:10.1371/journal.pmed.0040005.</p></li>
<li><p>Ronald, Pamela and Raoul Adamchak. <em>Tomorrow’s Table</em>. Oxford and New York: Oxford University Press, 2008.</p></li>
<li><p>Steel, Daniel, and Kyle Powys Whyte. “Environmental Justice, Values, and Scientific Expertise.” <em>Kennedy Institute of Ethics Journal</em> 22, no. 2: 163–182.</p></li>
</ul>
<div id="footer">
<p><span id="timestamp">January 30th, 2013 9:07am</span> <span class="tag">(philosophy of) science</span> <span class="tag">economics</span></p>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-copyright"><h2 class="anchored quarto-appendix-heading">Copyright</h2><div class="quarto-appendix-contents"><div>Dan Hicks</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dhicks\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>