{"title":"Difference-in-differences in R","markdown":{"yaml":{"title":"Difference-in-differences in R","categories":["data"],"date":"2018-10-10"},"containsRefs":false,"markdown":"\n\nThis post recreates [this post](https://the-tarzan.com/2011/06/20/differences-in-differences-estimation-in-r-and-stata/) with proper formatting, syntax highlighting, etc. \n\n```{r}\nlibrary(tidyverse)\nlibrary(skimr)\n```\n\nFirst we'll load the data (download if necessary).  I just started playing around with `skimr::skim()` to generate nice summaries.  (`digits` doesn't seem to do anything, though?)\n\n\n```{r}\ndata_file = '../_data/did_data.dta'\nif (!file.exists(data_file)) {\n    download.file(url = 'https://drive.google.com/uc?authuser=0&id=0B0iAUHM7ljQ1cUZvRWxjUmpfVXM&export=download', \n                  destfile = data_file)\n}\n\ndataf = haven::read_dta(data_file)\nskim(dataf, work, year, children)\n```\n\nFollowing the old post, we need to construct dummy variables for (a) before-and-after the EITC takes effect in 1994 and (b) the treatment group (1 or more children).  We'll keep these as logicals (rather than the numerics in the old post).  \n\n\n```{r}\ndataf = dataf %>%\n    mutate(post93 = year >= 1994, \n           anykids = children >= 1)\n```\n\nThe regression equation is \n\n$$ work = \\beta_0 + \\delta_0 post93 + \\beta_1 anykids + \\delta_1 (anykids \\times post93) + \\varepsilon. $$\n\nThe \"difference-in-differences coefficient\" is $$\\delta_1$$, which indicates how the effect of kids changed after the EITC went into effect. Let's take a second to plot this.  \n\n\n```{r}\nggplot(dataf, aes(post93, work, color = anykids)) +\n    geom_jitter() +\n    theme_minimal()\n```\n\nOkay, so the scatterplot version, like, isn't perspicuous.  How about the un-dummied variables, and just the mean?  \n\n\n```{r}\nggplot(dataf, aes(year, work, color = anykids)) +\n    stat_summary(geom = 'line') +\n    geom_vline(xintercept = 1994) +\n    theme_minimal()\n```\n\nThe parallel trends assumption looks good, at least qualitatively.  (Remember this only applies prior to the intervention.)  However, the parallel trends are nonlinear, which maybe is why the example uses the dummied variable.  \n\nAnyway, on to the regression.  Which, hey, is a [linear probability model](https://en.wikipedia.org/wiki/Linear_probability_model) because econometricians are funny like that.  \n\n\n```{r}\nmodel = lm(work ~ anykids*post93, data = dataf)\nsummary(model)\n```\n\nThis indicates that the EITC increased `work` (workforce participation? whether someone was employed?) by 5% among families with at least 1 child.  In the second plot, the blue line goes from about 45% prior to 1994 to about 50% afterwards.  \n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"output-file":"2018-10-10-did.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.280","theme":"yeti","title-block-banner":true,"author":"Dan Hicks","title":"Difference-in-differences in R","categories":["data"],"date":"2018-10-10"},"extensions":{"book":{"multiFile":true}}}}}