{
  "hash": "b0899164bc1bd45421f18930f8ef7346",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-differences in R\"\ncategories: [data]\ndate: \"2018-10-10\"\n---\n\n\nThis post recreates [this post](https://the-tarzan.com/2011/06/20/differences-in-differences-estimation-in-r-and-stata/) with proper formatting, syntax highlighting, etc. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(skimr)\n```\n:::\n\n\nFirst we'll load the data (download if necessary).  I just started playing around with `skimr::skim()` to generate nice summaries.  (`digits` doesn't seem to do anything, though?)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_file = '../_data/did_data.dta'\nif (!file.exists(data_file)) {\n    download.file(url = 'https://drive.google.com/uc?authuser=0&id=0B0iAUHM7ljQ1cUZvRWxjUmpfVXM&export=download', \n                  destfile = data_file)\n}\n\ndataf = haven::read_dta(data_file)\nskim(dataf, work, year, children)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |      |\n|:------------------------|:-----|\n|Name                     |dataf |\n|Number of rows           |13746 |\n|Number of columns        |11    |\n|_______________________  |      |\n|Column type frequency:   |      |\n|numeric                  |3     |\n|________________________ |      |\n|Group variables          |None  |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|    mean|   sd|   p0|  p25|  p50|  p75| p100|hist  |\n|:-------------|---------:|-------------:|-------:|----:|----:|----:|----:|----:|----:|:-----|\n|work          |         0|             1|    0.51| 0.50|    0|    0|    1|    1|    1|▇▁▁▁▇ |\n|year          |         0|             1| 1993.35| 1.70| 1991| 1992| 1993| 1995| 1996|▇▃▃▃▃ |\n|children      |         0|             1|    1.19| 1.38|    0|    0|    1|    2|    9|▇▃▁▁▁ |\n:::\n:::\n\n\nFollowing the old post, we need to construct dummy variables for (a) before-and-after the EITC takes effect in 1994 and (b) the treatment group (1 or more children).  We'll keep these as logicals (rather than the numerics in the old post).  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndataf = dataf %>%\n    mutate(post93 = year >= 1994, \n           anykids = children >= 1)\n```\n:::\n\n\nThe regression equation is \n\n$$ work = \\beta_0 + \\delta_0 post93 + \\beta_1 anykids + \\delta_1 (anykids \\times post93) + \\varepsilon. $$\n\nThe \"difference-in-differences coefficient\" is $$\\delta_1$$, which indicates how the effect of kids changed after the EITC went into effect. Let's take a second to plot this.  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(dataf, aes(post93, work, color = anykids)) +\n    geom_jitter() +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2018-10-10-did_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nOkay, so the scatterplot version, like, isn't perspicuous.  How about the un-dummied variables, and just the mean?  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(dataf, aes(year, work, color = anykids)) +\n    stat_summary(geom = 'line') +\n    geom_vline(xintercept = 1994) +\n    theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNo summary function supplied, defaulting to `mean_se()`\n```\n:::\n\n::: {.cell-output-display}\n![](2018-10-10-did_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThe parallel trends assumption looks good, at least qualitatively.  (Remember this only applies prior to the intervention.)  However, the parallel trends are nonlinear, which maybe is why the example uses the dummied variable.  \n\nAnyway, on to the regression.  Which, hey, is a [linear probability model](https://en.wikipedia.org/wiki/Linear_probability_model) because econometricians are funny like that.  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel = lm(work ~ anykids*post93, data = dataf)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = work ~ anykids * post93, data = dataf)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.5755 -0.4908  0.4245  0.5092  0.5540 \n\nCoefficients:\n                        Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             0.575460   0.008845  65.060  < 2e-16 ***\nanykidsTRUE            -0.129498   0.011676 -11.091  < 2e-16 ***\npost93TRUE             -0.002074   0.012931  -0.160  0.87261    \nanykidsTRUE:post93TRUE  0.046873   0.017158   2.732  0.00631 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4967 on 13742 degrees of freedom\nMultiple R-squared:  0.0126,\tAdjusted R-squared:  0.01238 \nF-statistic: 58.45 on 3 and 13742 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThis indicates that the EITC increased `work` (workforce participation? whether someone was employed?) by 5% among families with at least 1 child.  In the second plot, the blue line goes from about 45% prior to 1994 to about 50% afterwards.  \n\n",
    "supporting": [
      "2018-10-10-did_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}